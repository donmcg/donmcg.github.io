---
layout: post
title: donmcg.github.io notebook 
tip: removing metadata from image
project: donmcg.github.io
author: donmc
date:   2025-10-27 01:00:00 -0700
---
{% include mathjax.html %}

# Notes for building donmc.github.io
Date of this post: {{ page.date | date: "%d %b %Y" }}

|[Published GitHub Site](https://donmcg.github.io) | [local site](http://localhost:4000) |

Preparing an image for inclusion on the site.

---

How to strip metadata from a file?

{% highlight bash %}
m2 $ man xattr
   $ xattr -c file.jpg

{% raw %}
{% endraw %}
{% endhighlight %}

---

Let's take a jpeg file taken on phone camera and play with it:

{% highlight bash %}
{% raw %}
First just look at an image file:
{% endraw %}
$ xattr dirty_tarp_mini_copy.jpeg 
com.apple.lastuseddate#PS
com.apple.quarantine

$ ls -l@ dirty_tarp_mini_copy.jpeg 
-rw-r--r--@ 1 donmc  staff  111601 Oct 27 07:49 dirty_tarp_mini_copy.jpeg
	com.apple.lastuseddate#PS	    16 
	com.apple.quarantine	    21 

$ xattr -l dirty_tarp_mini_copy.jpeg 
com.apple.lastuseddate#PS: _??h
com.apple.quarantine: 0082;68ff865f;Photos;

$ xattr -lv dirty_tarp_mini_copy.jpeg 
dirty_tarp_mini_copy.jpeg: com.apple.lastuseddate#PS: _??h
dirty_tarp_mini_copy.jpeg: com.apple.quarantine: 0082;68ff865f;Photos;

$ xattr -p com.apple.quarantine dirty_tarp_mini_copy.jpeg 
0082;68ff865f;Photos;

{% endhighlight %}

There is not as much data as I was expecting. 

Now consider the one and only image file that I've already loaded on the site:

{% highlight bash %}
{% raw %}
First just look at the image file:
{% endraw %}
$ xattr -l hif44.exploded.gif 
com.apple.lastuseddate#PS: ?)ih
com.apple.metadata:_kMDItemUserTags: bplist00?
com.apple.metadata:kMDItemDownloadedDate: bplist00?3A???
                                                        ?

com.apple.metadata:kMDItemWhereFroms: bplist00?_>https://www.scparts.co.uk/media/catalog/category//2/5/2587.gif

com.apple.metadata:kMDLabel_iq67qk3hyamtwswtge4dkqnimm: ?or ??mu]v??<?Ɍ<?O??Yc-F?m?t??ː??J??:A?ɢ;m???K??J4
com.apple.quarantine: 0083;5a81bdf4;Safari;344CEFE3-13E6-4FCC-8957-9379021C208F

$ ls -l@ dirty_hif44.exploded.gif 
-rw-r--r--@ 1 donmc  staff  91874 Oct 27 08:23 dirty_hif44.exploded.gif
	com.apple.lastuseddate#PS	   16 
	com.apple.metadata:_kMDItemUserTags	   42 
	com.apple.metadata:kMDItemDownloadedDate	   53 
	com.apple.metadata:kMDItemWhereFroms	  109 
	com.apple.metadata:kMDLabel_iq67qk3hyamtwswtge4dkqnimm	   89 
	com.apple.quarantine	   57 

{% endhighlight %}

That looks a bit more scary. It seems to show where the image came from and
the browser used for the download.  The other cryptic stuff is hair-raising!

Let's see what happens if the metadata is removed:

{% highlight bash %}
{% raw %}
Remove all of it:
{% endraw %}
$ xattr -c clear_hif44.exploded.gif 
$ xattr -l clear_hif44.exploded.gif 
$ ll
-rw-r--r--  1 donmc  staff   91874 Oct 27 08:53 clear_hif44.exploded.gif
-rw-r--r--@ 1 donmc  staff   91874 Oct 27 08:23 dirty_hif44.exploded.gif

{% endhighlight %}

Clearing the metadata seems to have done *something*, but the file size
did not change.

Let's see what git has to say:

{% highlight bash %}
{% raw %}
Does git see a difference?:
{% endraw %}
$ git status hif44.exploded.gif 
On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean
$ cp hif44.exploded.gif dirty_hif44.exploded.gif 
$ ll
total 368
-rw-r--r--@ 1 donmc  staff  91874 Oct 27 08:57 dirty_hif44.exploded.gif
-rw-r--r--@ 1 donmc  staff  91874 Feb 12  2018 hif44.exploded.gif
$ git status .
On branch main
Your branch is up to date with 'origin/main'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	dirty_hif44.exploded.gif

nothing added to commit but untracked files present (use "git add" to track)

$ xattr -c hif44.exploded.gif 
$ ll
total 368
-rw-r--r--@ 1 donmc  staff  91874 Oct 27 08:57 dirty_hif44.exploded.gif
-rw-r--r--  1 donmc  staff  91874 Feb 12  2018 hif44.exploded.gif
$ git status hif44.exploded.gif 
On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean

$ diff dirty_hif44.exploded.gif hif44.exploded.gif 

{% endhighlight %}

Hmm, git sees no difference, diff sees no difference.  The only difference
appears to be the file status changing from
'-rw-r--r--@' to '-rw-r--r-- '.


At the moment I'm not feeling it...

What does google AI say?

---

@ (Final character): The at sign indicates that the file has **extended attributes**. This is a macOS-specific feature that allows extra information to be stored with a file beyond the standard permissions. 

#### What are extended attributes?

Extended attributes can contain various types of metadata. Common examples include:


- **Quarantine information**: A com.apple.quarantine attribute is added when you download a file from the internet, which causes macOS to issue a warning when you first open the file.

- **Resource forks**: Historically used by Mac OS for data such as icons and application properties.

- **Other metadata**: Attributes added by applications, such as Finder comments or specific text encoding details. 

#### How to view and manage extended attributes

- **To view the extended attributes**: Use the command xattr -l <filename>.

- **To view attributes and their sizes**: Use ls -l@ <filename>.

- **To remove extended attributes**: Use the command xattr -d <attribute_name> <filename> or xattr -c <filename> to remove all attributes. 

---

So what metadata is actually carried in the image file?
It seems that the metadata is not actually contained in the file?
That seems weird and unlikely.

{% highlight bash %}
{% raw %}
Download the image from the github.io site and compare
{% endraw %}
$ xattr -l dirty_hif44.exploded.gif 
com.apple.lastuseddate#PS: ?)ih
com.apple.metadata:_kMDItemUserTags: bplist00?
com.apple.metadata:kMDItemDownloadedDate: bplist00?3A???
                                                        ?

com.apple.metadata:kMDItemWhereFroms: bplist00?_>https://www.scparts.co.uk/media/catalog/category//2/5/2587.gif

com.apple.metadata:kMDLabel_iq67qk3hyamtwswtge4dkqnimm: ?or ??mu]v??<?Ɍ<?O??Yc-F?m?t??ː??J??:A?ɢ;m???K??J4
com.apple.quarantine: 0083;5a81bdf4;Safari;344CEFE3-13E6-4FCC-8957-9379021C208F

$ xattr -l download_hif44.exploded.gif 
com.apple.quarantine: 0083;68ff9d54;com.apple.Safari.SandboxBroker.xpc;3F84C3B8-00A2-4451-A323-FE9D35E4CD1A

$ ll *.gif
-rw-r--r--  1 donmc  staff  91874 Oct 27 08:53 clear_hif44.exploded.gif
-rw-r--r--@ 1 donmc  staff  91874 Oct 27 08:23 dirty_hif44.exploded.gif
-rw-r--r--@ 1 donmc  staff  91874 Oct 27 09:28 download_hif44.exploded.gif
{% endhighlight %}

That's pretty magical and frightening.  The file sizes are all the same.
the **@** flag indicates "extended attributes", those attributes follow
the file when it's copied and moved around (on the OS). Yet the
attributes change when the file comes from an external source. 

This suggests that **@** is, at least, referencing some kind of tracking
database in the OS.  

WTF??

Perhaps $$extended \stackrel{?}{\neq} metadata$$ !

Maybe I'm looking for imagemagick / mogrify or similar?
Or maybe ExifTool?

It would run like this:

{% highlight bash %}
$ # show all metadata
$ exiftool image.jpg
{% endhighlight %}

Let's install exiftool!

{% highlight bash %}
m2 $ brew update
...
$ brew upgrade
...
$ brew install exiftool
...
$ exiftool -ver
13.36
{% endhighlight %}

Now let's try it...

{% highlight bash %}
$ exiftool dirty_tarp_mini.jpeg 
ExifTool Version Number         : 13.36
File Name                       : dirty_tarp_mini.jpeg
Directory                       : .
... and on and on ...

A safer example:

$ exiftool dirty_hif44.exploded.gif 
ExifTool Version Number         : 13.36
File Name                       : dirty_hif44.exploded.gif
Directory                       : .
File Size                       : 92 kB
File Modification Date/Time     : 2025:10:27 08:23:17-07:00
File Access Date/Time           : 2025:10:27 08:23:17-07:00
File Inode Change Date/Time     : 2025:10:27 08:24:28-07:00
File Permissions                : -rw-r--r--
File Type                       : GIF
File Type Extension             : gif
MIME Type                       : image/gif
GIF Version                     : 89a
Image Width                     : 950
Image Height                    : 1267
Has Color Map                   : Yes
Color Resolution Depth          : 5
Bits Per Pixel                  : 5
Background Color                : 0
Image Size                      : 950x1267
Megapixels                      : 1.2

{% endhighlight %}

OK, this is what I am looking for!  Yes there is a ton of sensitive metadata!

The image I captured with my camera has some data I'd rather not publish.
The hif44 image, I downloaded from web, is much safer.

Here's the difference by mogrify:

{% highlight bash %}
$ mogrify dirty_tarp_mini_copy.jpeg 
$ exiftool dirty_tarp_mini.jpeg > dirty.raw
$ exiftool dirty_tarp_mini_copy.jpeg > dirty.mog
$ diff dirty.raw dirty.mog
2c2
< File Name                       : dirty_tarp_mini.jpeg
---
> File Name                       : dirty_tarp_mini_copy.jpeg
4,7c4,7
< File Size                       : 112 kB
< File Modification Date/Time     : 2025:10:27 07:49:03-07:00
< File Access Date/Time           : 2025:10:27 07:49:03-07:00
< File Inode Change Date/Time     : 2025:10:27 07:50:56-07:00
---
> File Size                       : 114 kB
> File Modification Date/Time     : 2025:10:28 06:44:02-07:00
> File Access Date/Time           : 2025:10:28 06:44:02-07:00
> File Inode Change Date/Time     : 2025:10:28 06:44:02-07:00
11a12
> JFIF Version                    : 1.01

{% endhighlight %}

Well, mogrify did not do much! It changed the timestamps and added JFIF.
It actually *increased* the file size!

Here's the difference by exiftool -all= :

{% highlight bash %}
$ exiftool -all= -overwrite_original dirty_tarp_mini_copy.jpeg 
Warning: ICC_Profile deleted. Image colors may be affected - dirty_tarp_mini_copy.jpeg
    1 image files updated
$ exiftool dirty_tarp_mini_copy.jpeg > dirty.exi
$ diff dirty.raw dirty.exi
... a huge number of differences ...

$ # its safe now to show the metadata of the cleaned image:
$ exiftool dirty_tarp_mini_copy.jpeg 
ExifTool Version Number         : 13.36
File Name                       : dirty_tarp_mini_copy.jpeg
Directory                       : .
File Size                       : 81 kB
File Modification Date/Time     : 2025:10:28 07:00:58-07:00
File Access Date/Time           : 2025:10:28 07:00:58-07:00
File Inode Change Date/Time     : 2025:10:28 07:00:58-07:00
File Permissions                : -rw-r--r--
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
Image Width                     : 480
Image Height                    : 640
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)
Image Size                      : 480x640
Megapixels                      : 0.307
{% endhighlight %}

Note the file size is now significantly reduced to 81kB from 112kB.
And a preview indicates the image still renders as desired.

Now I have a way to remove that pesky metadata!

---

&nbsp;

#### And as a demonstration, here is the clean image of my mini!

![mini covered in tarp]( /assets/image/tarp_mini.jpeg  "tarp mini")


---

&nbsp;
#### Some interesting links:

[xattr man page](https://ss64.com/mac/xattr.html)

[apple.com.quarantine](https://stackoverflow.com/questions/46198557/understanding-output-of-xattr-p-com-apple-quarantine)

[mathJax tutorial](https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference)

[LaTex Cheatsheet](https://harrywang.me/latex)

[LaTex reference sheet](https://wch.github.io/latexsheet/latexsheet.pdf)

[exiftool man page](https://linux.die.net/man/1/exiftool)


