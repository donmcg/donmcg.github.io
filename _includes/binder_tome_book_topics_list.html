{% comment %}
---
layout: default
title: category links for a single tome organized by topic
---
{% endcomment %}

{% comment use this include as follows %}
include binder_tome_book_topics_list collection=site.**collection** tome=**tome**
{% endcomment %}

{% comment %}
<br>
pages: {{ pages }}<br>
include.pages: {{ include.pages }}<br>
category: {{ category }}<br>
site.vegetable: {{ site.vegetable }}<br>
site.string: {{ site."vegetable" }}<br> <!-- works -->
site.string2: {{ "site.vegetable" }}<br> <!-- doesn't work -->
{% assign mypages = site. | append: {{category}} %}
mypages: {{ mypages }}<br> <!-- does something... but what? -->
site: {{ site }}<br> <!-- works -->
categories: {{ site.categories }} <br>
collections: {{ site.collections }} <br>

include.collection: {{ include.collection }} <br> <!-- works -->
{% endcomment %}

<!-- <h3> Searching for book topics of the tome "{{ include.tome }}"</h3> -->

	{% assign topics = "" | split: ',' %}
  {% for file in include.collection %}
	  {% if file.binder.tome == include.tome %}
		<!-- file title: "{{ file.title }}" level: {{file.binder.level}} belongs to tome "{{ include.tome }}" <br> -->
		  {% if file.binder.level == "book" %}
			<!-- limit displayed topics to those associated with books -->
    	  <!--	  <p>file title: {{ file.title }}</p> -->
          {% for topic in file.binder.topics %}
		        {% if topics contains topic %}
			      {% else %}
						<!-- new topic "{{topic}}" found in {{ file.title }}<br> -->
			        {% assign topics = topics | push: topic %}
			      {% endif %}
	      {% endfor %}
		  {% endif %}
		{% endif %}
	{% endfor %}

{% comment %}
<h3> Searching for topic pages in the book "{{ include.book }}"</h3>
	{% assign topics = "" | split: ',' %}
  {% for page in include.pages %}
	<!--	  <p>page title: {{ page.title }}</p> -->
	<p>page title: {{ page.title }}</p>
    {% for topic in page.topics %}
		  {% if topics contains topic %}
			{% else %}
			<!--		{{ topic }} new topic found on {{ page.title }}<br> --> 
			{{ topic }} new topic found on {{ page.title }}<br> 
			  {% assign topics = topics | push: topic %}
			{% endif %}
	  {% endfor %}
	{% endfor %}
{% endcomment %}

	<br>
	{% comment %}
	topics:    {{topics}}<br>
	topics[0]: {{topics[0]}}<br>
	topics[1]: {{topics[1]}}<br>
	topics[2]: {{topics[2]}}<br>
	topics[3]: {{topics[3]}}<br>

	Here are the topics found for tome "{{ include.tome }}": <br>
	{% for topic in topics %}
	  topic: "{{ topic }}" <br>
	{% endfor %}
  <br>

	Building topic lists:
	{% endcomment %}

			{% comment %}
			This approach has high overhead?
			{% endcomment %}

	{% assign topic_pages = "" | split: '|' %}
  {% for topic in topics %}
	<!--	<h3>	{{ topic }}</h3> -->
    {% for page in include.collection %}
		  {% if page.binder.tome == include.tome %}
		    {% if page.binder.level == "book" %}

    		  {% if page.binder.topics contains topic %}
  	        {% assign page_ref = topic | append: ',' | append: page.url | append: ',' | append: page.title | split: ',' %}
  	        {% assign topic_pages = topic_pages | push: page_ref %}
  
  {% comment %}
  page.title: {{page.title}}<br>
  page.url: {{page.url}}<br>
  page_ref: {{page_ref}}<br  >
  page_ref[0]: {{ page_ref[0] }}<br>
  page_ref[1]: {{ page_ref[1] }}<br>
  page_ref[2]: {{ page_ref[2] }}<br>
  topic_pages so far:		{{ topic_pages }}<br><br>
  <br>
  {% endcomment %}
  
			    {% endif %}

			  {% endif %}
			{% endif %}
    {% endfor %}
	{% endfor %}

{% comment %}
  <br>
	topic_pages[0]: {{topic_pages[0]}}<br>
	topic_pages[0][0]: {{topic_pages[0][0]}}<br>
	topic_pages[0][1]: {{topic_pages[0][1]}}<br>
	topic_pages[0][2]: {{topic_pages[0][2]}}<br>
	topic_pages[1]: {{topic_pages[1]}}<br>
	topic_pages[2]: {{topic_pages[2]}}<br>
	<br>
{% endcomment %}

<div>
	<ol>
  {% for topic in topics %}
	<!-- <li>{{ topic | capitalize }}</li> -->
	<li>{{ topic }}</li>
	  <blockquote>
			<ol>
    {% for page_ref in topic_pages %}
		  {% if topic == page_ref[0] %}
        <li><a href="{{ page_ref[1] }}">{{ page_ref[2] }}</a></li>
			{% endif %}
	  {% endfor %}
			</ol>
	  </blockquote>
	{% endfor %}
	</ol>
</div>

